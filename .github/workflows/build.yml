name: Build and Test

# ğŸ¯ DÃ‰CLENCHEURS
# Quand ce workflow s'exÃ©cute
on:
  push:
    branches: [ main, dev ]  # Sur push vers main ou dev
  pull_request:
    branches: [ main ]           # Sur PR vers main
  workflow_dispatch:             # Permet lancement manuel

# ğŸ”§ JOBS
jobs:
  build:
    name: Build with Maven
    runs-on: ubuntu-latest       # Machine virtuelle Ubuntu
    
    # ğŸ“‹ Ã‰TAPES
    steps:
    # 1ï¸âƒ£ RÃ©cupÃ©rer le code
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4  # Action officielle GitHub
      # Cette action clone votre repo dans le runner
    
    # 2ï¸âƒ£ Installer Java
    - name: â˜• Set up JDK 25
      uses: actions/setup-java@v4
      with:
        java-version: '25'       # Version Java
        distribution: 'temurin'  # Distribution (Adoptium)
        cache: 'maven'           # Cache des dÃ©pendances Maven
        # Le cache accÃ©lÃ¨re les builds suivants
    
    # 3ï¸âƒ£ Afficher les versions
    - name: ğŸ“Š Display versions
      run: |
        echo "Java version:"
        java -version
        echo "Maven version:"
        mvn -version
    
    # 4ï¸âƒ£ Compiler le projet
    - name: ğŸ”¨ Build with Maven
      run: mvn clean compile
      # Ã‰quivalent Ã  lancer "mvn clean compile" en local
    
    # 5ï¸âƒ£ ExÃ©cuter les tests (si vous en avez)
    - name: ğŸ§ª Run tests
      run: mvn test
      continue-on-error: true    # Ne pas Ã©chouer si pas de tests
    
    # 6ï¸âƒ£ CrÃ©er le package JAR
    - name: ğŸ“¦ Package application
      run: mvn package -DskipTests
      # -DskipTests car dÃ©jÃ  testÃ©s Ã  l'Ã©tape prÃ©cÃ©dente
    
    # 7ï¸âƒ£ Uploader le JAR comme artefact
    - name: ğŸ“¤ Upload JAR artifact
      uses: actions/upload-artifact@v4
      with:
        name: jest-game-jar       # Nom de l'artefact
        path: target/*.jar        # Fichiers Ã  uploader
        retention-days: 30        # Garder 30 jours
        # Les artefacts sont accessibles dans l'onglet Actions